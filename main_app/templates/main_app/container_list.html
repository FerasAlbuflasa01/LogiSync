{% extends 'base.html' %}
{% block content %}
<div class="page-header">
  <h1>Container List</h1>
</div>

<br />

<div class="search-filter-bar">
  <form class="d-flex" method="POST" action="{% url 'container_list' %}">
    {% csrf_token %}
    <input type="hidden" name="action" value="search" />

    <input
      class="form-control me-2"
      type="search"
      placeholder="Search by code (e.g., C-2025-0012)"
      aria-label="Search"
      name="searched"
      value="{{ request.GET.searched }}"
    />
    <button class="btn btn-outline-secondary" type="submit">Search</button>
  </form>

  <div class="filter-buttons">
    <a class="btn" href="{% url 'container_list' %}">All</a>
    <a class="btn" href="{% url 'container_list' %}?status=assigned">Assigned</a>
    <a class="btn" href="{% url 'container_list' %}?status=unassigned">Unassigned</a>
  </div>
</div>


{% if search_result %}
<div class="card">
  <div class="card-content">
    <h2>Result for "{{ search_result.code }}"</h2>
    <a href="{% url 'container_detail' search_result.id %}">
      <p><strong>Code:</strong> {{ search_result.code }}</p>
      <p><strong>Description:</strong> {{ search_result.description }}</p>
      <p><strong>Capacity:</strong> {{ search_result.weight_capacity }}</p>
      <p><strong>Current:</strong> {{ search_result.currnt_weight_capacity }}</p>
    </a>
    <a href="{% url 'container_list' %}"><button>Back</button></a>

  </div>
</div>

{% elif message %}
<p style="color: red">{{ message }}</p>
<a href="{% url 'container_list' %}"><button>Back</button></a>

{% else %}
  {% for container in containers %}
  <div class="card">
    <div class="card-content">
      <a href="{% url 'container_detail' container.id %}">
        <span class="card-title">{{ container.code }}</span>
      </a>
      <p><strong>Description:</strong> {{ container.description }}</p>
      <p><strong>Capacity:</strong> {{ container.weight_capacity }}</p>
      <p><strong>Current:</strong> {{ container.currnt_weight_capacity }}</p>

      {% if is_supervisor %}
      <form method="post" class="d-flex gap-2 align-items-center mt-2">
        {% csrf_token %}
        <input type="hidden" name="action" value="assign_container" />
        {{ form.container_id }} {{ form.assignee }}
        <button type="submit" class="btn btn-primary btn-sm">Assign</button>
      </form>
      {% endif %}
    </div>

  </div>
  {% empty %}
  <p>No containers found.</p>
  {% endfor %}
{% endif %}

{% endblock %}
